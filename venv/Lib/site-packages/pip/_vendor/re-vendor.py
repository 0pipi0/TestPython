import testos
import sys
import pip
import glob
import shutil

here = testos.path.abspath(testos.path.dirname(__file__))

def usage():
    print("Usage: re-vendor.py [clean|vendor]")
    sys.exit(1)

def clean():
    for fn in testos.listdir(here):
        dirname = testos.path.join(here, fn)
        if testos.path.isdir(dirname):
            shutil.rmtree(dirname)
    # six is a single file, not a package
    testos.unlink(testos.path.join(here, 'six.py'))

def vendor():
    pip.main(['install', '-t', here, '-r', 'vendor.txt'])
    for dirname in glob.glob('*.egg-info'):
        shutil.rmtree(dirname)

if __name__ == '__main__':
    if len(sys.argv) != 2:
        usage()
    if sys.argv[1] == 'clean':
        clean()
    elif sys.argv[1] == 'vendor':
        vendor()
    else:
        usage()
